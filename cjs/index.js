var Ot=Object.create;var O=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Ft=Object.getPrototypeOf,Mt=Object.prototype.hasOwnProperty;var it=(t,e)=>{for(var n in e)O(t,n,{get:e[n],enumerable:!0})},st=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Nt(e))!Mt.call(t,i)&&i!==n&&O(t,i,{get:()=>e[i],enumerable:!(o=At(e,i))||o.enumerable});return t};var A=(t,e,n)=>(n=t!=null?Ot(Ft(t)):{},st(e||!t||!t.__esModule?O(n,"default",{value:t,enumerable:!0}):n,t)),Rt=t=>st(O({},"__esModule",{value:!0}),t);var qt={};it(qt,{bindFetchDelay:()=>K,bindPromiseDelay:()=>at,bindWaitByEvent:()=>lt,bindWaitByFech:()=>$,createTesting:()=>It,isFetching:()=>z,isNeedTesting:()=>tt,onTesting:()=>q,testingOptions:()=>r});module.exports=Rt(qt);var r={timeout:5e3,stepDelay:100,fetchDelay:0,maskTime:0,keepSameKey:!1,minLogDelay:250,testReStartKey:"",testAgainKey:"",enable:void 0,onError:(t,e)=>{},onBeforeEach:t=>{},onTagChange:(t,e)=>{},selects:[],push:t=>(location.href=t,new Promise(e=>setTimeout(e,100))),e2e:()=>{}};var G;function E(t){let e=document.getElementById("testing-label");e||(e=document.createElement("div"),e.id="testing-label",e.style.pointerEvents="none",e.style.transition=`all ${r.stepDelay<50?50:r.stepDelay*.7}ms ease`,e.style.background="rgba(0,0,0,0.5)",e.style.color="#f33",e.style.height="auto",e.style.borderRadius="6px",e.style.zIndex="99999",e.style.position="fixed",e.style.padding="4px 8px",e.style.right="0px",e.style.bottom="0px",e.style.whiteSpace="nowrap",e.style.transformOrigin="center",document.body.append(e)),e.textContent=t,e.style.opacity="1",G&&clearTimeout(G),G=setTimeout(()=>{e.style.opacity="0"},5e3)}function at(t,e){if(e<1)return t;let n=t;return async function(...o){let i=n(...o).finally(()=>{});return e>=r.minLogDelay&&E("Fetch delay: "+e+"ms"),await new Promise(s=>setTimeout(s,e)),i}}function K(t){window.fetch=at(window.fetch,t)}var j=0;function lt(t,e){let n=t;return async function(...o){return e&&e(...o)?n(...o):(j+=1,n(...o).finally(()=>{j-=1}))}}var ct=!1;function $(){ct||(ct=!0,window.fetch=lt(window.fetch,t=>/\.(svg|jpg|png|gif)/.test(t)))}function z(){return j>0}var ut="Test all",N="TEST",U="Step delay",V="Fetch delay",Y="Test again",J="!! Quit testing mode",x="testing",L="testing-state",y="testing-state-result";var v={};it(v,{cleanTasks:()=>d,getDoing:()=>D,getFetchDelay:()=>k,getStepTime:()=>b,isDone:()=>Q,setDoing:()=>h,setDone:()=>R,setFetchDelay:()=>X,setStepTime:()=>W,storageGet:()=>u,storageRemove:()=>l,storageSet:()=>c});var F="testing-history";function l(t){typeof window>"u"||sessionStorage.removeItem(t)}function u(t){if(typeof window>"u")return;let e=sessionStorage.getItem(t);if(!!e)try{return JSON.parse(e).j}catch{return}}function c(t,e){typeof window>"u"||sessionStorage.setItem(t,JSON.stringify({j:e}))}function M(){let t=u(F);return t||(t={}),t}function Q(t){let e=M();return e[e.doing+t]==="done"}function R(t){let e=M();e[e.doing+t]="done",c(F,e)}function h(t){let e=M();e.doing=t,c(F,e)}function D(){return M().doing}function d(){l(y),c(F,{})}function W(t){c("stepTime",t)}function b(){let t=u("stepTime");return t!==0&&!t?null:t}function X(t){c("fetchDelay",t)}function k(){let t=u("fetchDelay");return t!==0&&!t?null:t}var mt=!1;function ft(){if(typeof window>"u"||r.testAgainKey===""&&r.testReStartKey===""||mt)return;mt=!0;let t=e=>{if(!e.ctrlKey&&!e.metaKey)return!0;if(e.key===r.testReStartKey){e.preventDefault(),e.stopPropagation();let n=D();return d(),h(n),r.e2e(),!1}return e.key===r.testAgainKey&&(e.preventDefault(),e.stopPropagation(),r.e2e()),!1};window.addEventListener("keydown",t)}var pt=A(require("crypto-es")),yt=t=>pt.default.MD5(t).toString();async function f(t=17){t<=0||(typeof requestIdleCallback>"u"||typeof requestAnimationFrame>"u"?await new Promise(e=>{setTimeout(()=>{e(void 0)},20)}):await new Promise(e=>requestAnimationFrame(e)),await new Promise(e=>{setTimeout(()=>{e(void 0)},t)}))}function Z(t,e=""){return typeof t=="string"?t:t==null?e:String(t)}var Ct=[N,U,V,Y],Ht=[J];function dt(t){t.innerHTML="";let e=document.createElement("select");e.value="TEST",e.name="testing-select",Object.assign(e.style,{appearance:"none",boxShadow:"none",border:"none",borderRadius:"0px",outline:"none",background:"rgba(0,0,0,0)",color:"#fff",padding:"0px",fontSize:"14px",position:"absolute",left:0,top:0,width:"100px",opacity:"0"}),Object.assign(t.style,{right:"0",top:"0",position:"fixed",zIndex:"9999",width:"100px",height:"20px",background:"#f33",opacity:"0.6",cursor:"pointer",transformOrigin:"left",display:"flex",justifyContent:"center",alignItems:"center",transform:"rotate(45deg) translate(11px, -50px)"});let n=document.createElement("div");Object.assign(n.style,{width:"100px",height:"100%",textAlign:"center",PointerEvent:"none",color:"#fff",marginTop:"3px",fontSize:"14px",fontWeight:"700"}),n.textContent="TEST",t.appendChild(n),t.append(e),[...Ct,...r.selects,...r.enable===void 0?Ht:[]].forEach(i=>{let s=document.createElement("option");s.value=i,s.textContent=i,e.append(s)}),e.onchange=i=>{let s=i.target.value;if(e.value=N,s===U){let a=Number(prompt("Please input step time(ms):",Z(b(),String(r.stepDelay))));if(isNaN(a))return;W(a);return}if(s===V){let a=Number(prompt("Please input step time(ms):",Z(k(),String(r.fetchDelay))));if(isNaN(a))return;X(a);return}if(s===J){d(),l(x),location.reload();return}if(s===N){d(),l(L);return}if(s===Y){let a=D();d(),h(a),r.e2e();return}r.onTagChange(s,v)}}function gt(){let t=document.getElementById("renderTestingTag");if(t){dt(t);return}let e=document.createElement("div");e.id="renderTestingTag",dt(e),document.body.appendChild(e)}var Tt=!1;function Et(){if(typeof window<"u"&&!Tt){Tt=!0;let t,e=0,n="http://";window.addEventListener("touchend",o=>{if(o.touches.length===1){if(e+=1,e>3)if(n=prompt(`\u5F53\u524D:${location.href}`,n)||"",n==="http://log"){let i=document.createElement("script");i.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",i.onload=()=>{new window.VConsole},document.head.append(i)}else n!=="http://"&&(location.href=n);t&&clearTimeout(t),t=setTimeout(()=>{e=0},2e3)}})}}function tt(){return typeof window>"u"||(Et(),/testing=remove/.test(location.href)&&(l("testing"),d()),!/testing=1/.test(location.href)&&u("testing")!=="1")?!1:(c("testing","1"),gt(),!0)}var et,nt;async function p(){return et||(et=await import("@testing-library/dom")),et}async function ht(){return nt||(nt=(await import("@testing-library/user-event")).default),nt}var w=async(t,e=3e3,n=0,o="Not found element")=>{if(n>e/100)throw new Error(o);let i=await t();return i||(await f(100),z()?w(t,e,n,o):w(t,e,n+1,o))},rt=async(t,e=3e3)=>w(async()=>{let n;return document.querySelectorAll("input, textarea").forEach(o=>{o.value===t&&(n=o)}),n},e,0,"Not found input element value is: "+t),S=async(t,e=3e3)=>w(async()=>(await p()).screen.queryByRole(t),e,0,"Not found role element: "+t),B=async(t,e=3e3)=>w(async()=>(await p()).screen.queryByTestId(t,{}),e),C=async(t,e=3e3)=>w(async()=>(await p()).screen.queryByText(t,{trim:!0}),e,0,"Not found text element: "+t),H=async(t,e=3e3)=>w(async()=>(await p()).screen.queryByLabelText(t,{trim:!0,selector:"*"}),e,0,"Not found label text element: "+t),wt=async(t,e,n=3e3)=>{let o=await S(t,n);return(await p()).fireEvent.change(o,{target:{value:e}}),o},xt=async(t,e=3e3)=>{let n=await S(t,e);return(await p()).fireEvent.click(n),n},bt=async(t,e,n=3e3)=>{let o=await B(t,n);return(await p()).fireEvent.change(o,{target:{value:e}}),o},kt=async(t,e=3e3)=>{let n=await B(t,e);return(await p()).fireEvent.click(n),n};function _t(t){if(typeof window>"u"||!t)return{left:0,top:0,width:0,height:0,fixedTop:0,fixedLeft:0};let e=t.getBoundingClientRect(),n={top:0,left:0},o=t;for(;o;)n.left+=o.offsetLeft,n.top+=o.offsetTop,o=o.offsetParent;return{left:e.left,top:e.top,width:e.width,height:e.height,fixedTop:n.top+document.documentElement.scrollTop,fixedLeft:n.left+document.documentElement.scrollLeft}}var _=0;function vt(t){let e=document.getElementById("testing-mask");e||(e=document.createElement("div"),e.id="testing-mask",e.style.pointerEvents="none",e.style.transition=`all ${r.stepDelay<100?100:r.stepDelay*.7}ms ease`,e.style.background="rgba(255,100,100,0.3)",e.style.border="1px solid rgba(128,128,128,0.3)",e.style.width="30px",e.style.height="30px",e.style.borderRadius="6px",e.style.zIndex="99999",e.style.position="fixed",e.style.transformOrigin="center",document.body.append(e)),_+=1,_>99&&(_=0);let n=_t(t);Object.assign(e.style,{opacity:"1",transform:`rotate(${_*720}deg)`,left:n.fixedLeft+n.width/2-15+"px",top:n.fixedTop+n.height/2-15+"px"})}function St(){let t=document.getElementById("testing-mask");t&&(t.style.opacity="0")}var Lt=!1;typeof window<"u"&&window.addEventListener("load",()=>{Lt=!0});async function Dt(){Lt||setTimeout(()=>{Dt()},50)}async function g(t,{beforeWait:e,afterWait:n,key:o},i){await T.it(t+(o||""),async()=>{e&&(e>=r.minLogDelay&&E("Before waiting: "+e+"ms, "+t),await f(e));let s=await i();s&&vt(s),n&&(n>=r.minLogDelay&&E("After waiting: "+n+"ms, "+t),await f(n))})}var I={},T={queryByLabelText:H,queryByRole:S,queryByTestId:B,queryByText:C,queryInputValue:rt,it:async function(t,e){let n=t;r.keepSameKey&&(I[t]||(I[t]=0),I[t]+=1,n=t+" "+I[t],Q(n))||(await Dt(),R(t+I),r.stepDelay>=r.minLogDelay&&E("Step delay: "+r.stepDelay+"ms"),await f(r.stepDelay),E(n),await f(20),await Promise.resolve(e()),R(n))},async push(t,e={}){return g(t,e,async()=>{await f(100),await r.push(t),await f(100)})},async wait(t,e){return T.it("[wait]"+t,async()=>{await new Promise(n=>setTimeout(n,e))})},async findByRole(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,async()=>S(t,e))},async findByText(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,async()=>C(t,e))},async findByLabelText(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,async()=>H(t,e))},async findByInputValue(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,()=>rt(t,e))},async clickByRole(t,{timeout:e=r.timeout,...n}={}){return g(t,n,async()=>xt(t,e))},async changeByRole(t,e,{timeout:n=r.timeout,...o}={}){return g(t,o,()=>wt(t,e,n))},async clickByTestId(t,{timeout:e=r.timeout,...n}={}){return g(t,n,()=>kt(t,e))},async changeByTestId(t,e,{timeout:n=r.timeout,...o}={}){return g("[changeByTestId] "+t,o,()=>bt(t,e,n))},not:async function(t,e,n=10){let o=0,i=async()=>{if(o>n)throw new Error("always find by: "+t);o+=1;try{return await f(100),await e(),i()}catch(s){if(!s.message)throw s;let a=s.message.split(`
`)[0];if(/Found multiple elements/.test(a))return i()}};return i()},notFindByRole:async function(t,e=300){return T.not(t,async()=>{await S(t,e)})},notFindByTestId:async function(t,e=300){return T.not(t,async()=>{await B(t,e)})},notFindByText:async function(t,e=300){return T.not(t,async()=>{await C(t,e)})},notFindByLabelText:async function(t,e=300){return T.not(t,async()=>{await H(t,e)})}};var ot;async function Bt(){if(!ot){let t=await p(),e=await ht(),n=(await import("@faker-js/faker")).faker;ot={testingLibrary:t,userEvent:e,faker:n,candy:T,md5:yt}}return ot}var q=async(t,e)=>{let n="";if(!tt())return;let o=await Bt();if(!!t){ft(),$(),r.stepDelay=b()!==null?b():r.stepDelay,r.fetchDelay=k()!==null?k():r.stepDelay,K(r.fetchDelay);try{if(Array.isArray(e))for(let i of e)n=t+"/"+i.id,h(n),await i.test(o,n),r.onBeforeEach(n)}catch(i){let s=Error(i.toString().split(`
`)[0],{cause:i});console.error(s),r.onError&&r.onError(s,n)}}};function It({onError:t,onSuccess:e,onBeforeEach:n,tests:o,enable:i=!0}){r.e2e=()=>{r.enable=i,i!==void 0&&(i?c(x,"1"):l(x)),n&&(r.onBeforeEach=n),r.onError=(a,m)=>{c(y,"fail"),t?.(a,m)},r.onTagChange=(a,m)=>{m.cleanTasks(),l(y),c(L,a),r.e2e()};let s={...o};Object.values(o).forEach((a,m)=>{a.forEach((P,Pt)=>{r.keepSameKey?P.id=`${P.name} [${m+1}/${Pt+1}]`:P.id=P.name})}),s[ut]=Object.values(s).flat(),r.selects=Object.keys(s),(async()=>{let a=u(L)||"";if(q("",[]),!u(y)){for(let m of r.selects){if(u(y)==="fail")break;a===m&&await q(m,s[m])}setTimeout(()=>{u(y)||(e?.(a),c(y,"success")),St()},100)}})()},r.e2e()}It.unEnable=()=>{l(x)};
