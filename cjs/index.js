var Pt=Object.create;var I=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Ot=Object.getOwnPropertyNames;var Nt=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty;var ot=(t,e)=>{for(var n in e)I(t,n,{get:e[n],enumerable:!0})},it=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ot(e))!Ft.call(t,i)&&i!==n&&I(t,i,{get:()=>e[i],enumerable:!(o=At(e,i))||o.enumerable});return t};var P=(t,e,n)=>(n=t!=null?Pt(Nt(t)):{},it(e||!t||!t.__esModule?I(n,"default",{value:t,enumerable:!0}):n,t)),Mt=t=>it(I({},"__esModule",{value:!0}),t);var _t={};ot(_t,{bindFetchDelay:()=>K,bindPromiseDelay:()=>st,bindWaitByEvent:()=>ct,bindWaitByFech:()=>$,createTesting:()=>Bt,isFetching:()=>z,isNeedTesting:()=>Z,onTesting:()=>q,testingOptions:()=>r});module.exports=Mt(_t);var r={timeout:5e3,stepDelay:100,fetchDelay:0,maskTime:0,keepSameKey:!1,testReStartKey:"",testAgainKey:"",enable:void 0,onError:(t,e)=>{},onBeforeEach:t=>{},onTagChange:(t,e)=>{},selects:[],push:t=>(location.href=t,new Promise(e=>setTimeout(e,100))),e2e:()=>{}};var G;function E(t){let e=document.getElementById("testing-label");e||(e=document.createElement("div"),e.id="testing-label",e.style.pointerEvents="none",e.style.transition=`all ${r.stepDelay<50?50:r.stepDelay*.7}ms ease`,e.style.background="rgba(0,0,0,0.5)",e.style.color="#f33",e.style.height="auto",e.style.borderRadius="6px",e.style.zIndex="99999",e.style.position="fixed",e.style.padding="4px 8px",e.style.right="0px",e.style.bottom="0px",e.style.whiteSpace="nowrap",e.style.transformOrigin="center",document.body.append(e)),e.textContent=t,e.style.opacity="1",G&&clearTimeout(G),G=setTimeout(()=>{e.style.opacity="0"},5e3)}function st(t,e){if(e<1)return t;let n=t;return async function(...o){let i=n(...o).finally(()=>{});return E("Fetch delay: "+e+"ms"),await new Promise(s=>setTimeout(s,e)),i}}function K(t){window.fetch=st(window.fetch,t)}var j=0;function ct(t,e){let n=t;return async function(...o){return e&&e(...o)?n(...o):(j+=1,n(...o).finally(()=>{j-=1}))}}var at=!1;function $(){at||(at=!0,window.fetch=ct(window.fetch,t=>/\.(svg|jpg|png|gif)/.test(t)))}function z(){return j>0}var lt="Test all",A="TEST",U="Step delay",V="Fetch delay",Y="Test again",J="!! Quit testing mode",x="testing",v="testing-state",y="testing-state-result";var b={};ot(b,{cleanTasks:()=>d,getDoing:()=>S,getFetchDelay:()=>R,getStepTime:()=>M,isDone:()=>Q,setDoing:()=>w,setDone:()=>F,setFetchDelay:()=>X,setStepTime:()=>W,storageGet:()=>u,storageRemove:()=>l,storageSet:()=>c});var O="testing-history";function l(t){typeof window>"u"||sessionStorage.removeItem(t)}function u(t){if(typeof window>"u")return;let e=sessionStorage.getItem(t);if(!!e)try{return JSON.parse(e).j}catch{return}}function c(t,e){typeof window>"u"||sessionStorage.setItem(t,JSON.stringify({j:e}))}function N(){let t=u(O);return t||(t={}),t}function Q(t){let e=N();return e[e.doing+t]==="done"}function F(t){let e=N();e[e.doing+t]="done",c(O,e)}function w(t){let e=N();e.doing=t,c(O,e)}function S(){return N().doing}function d(){l(y),c(O,{})}function W(t){c("stepTime",t)}function M(){let t=u("stepTime");return t!==0&&!t?null:t}function X(t){c("fetchDelay",t)}function R(){let t=u("fetchDelay");return t!==0&&!t?null:t}var ut=!1;function ft(){if(typeof window>"u"||r.testAgainKey===""&&r.testReStartKey===""||ut)return;ut=!0;let t=e=>{if(!e.ctrlKey&&!e.metaKey)return!0;if(e.key===r.testReStartKey){e.preventDefault(),e.stopPropagation();let n=S();return d(),w(n),r.e2e(),!1}return e.key===r.testAgainKey&&(e.preventDefault(),e.stopPropagation(),r.e2e()),!1};window.addEventListener("keydown",t)}var Rt=[A,U,V,Y],Ct=[J];function mt(t){t.innerHTML="";let e=document.createElement("select");e.value="TEST",e.name="testing-select",Object.assign(e.style,{appearance:"none",boxShadow:"none",border:"none",borderRadius:"0px",outline:"none",background:"rgba(0,0,0,0)",color:"#fff",padding:"0px",fontSize:"14px",position:"absolute",left:0,top:0,width:"100px",opacity:"0"}),Object.assign(t.style,{right:"0",top:"0",position:"fixed",zIndex:"9999",width:"100px",height:"20px",background:"#f33",opacity:"0.6",cursor:"pointer",transformOrigin:"left",display:"flex",justifyContent:"center",alignItems:"center",transform:"rotate(45deg) translate(11px, -50px)"});let n=document.createElement("div");Object.assign(n.style,{width:"100px",height:"100%",textAlign:"center",PointerEvent:"none",color:"#fff",marginTop:"3px",fontSize:"14px",fontWeight:"700"}),n.textContent="TEST",t.appendChild(n),t.append(e),[...Rt,...r.selects,...r.enable===void 0?Ct:[]].forEach(i=>{let s=document.createElement("option");s.value=i,s.textContent=i,e.append(s)}),e.onchange=i=>{let s=i.target.value;if(e.value=A,s===U){let a=Number(prompt("Please input step time(ms):"));if(isNaN(a))return;W(a);return}if(s===V){let a=Number(prompt("Please input step time(ms):"));if(isNaN(a))return;X(a);return}if(s===J){d(),l(x),location.reload();return}if(s===A){d(),l(v);return}if(s===Y){let a=S();d(),w(a),r.e2e();return}r.onTagChange(s,b)}}function pt(){let t=document.getElementById("renderTestingTag");if(t){mt(t);return}let e=document.createElement("div");e.id="renderTestingTag",mt(e),document.body.appendChild(e)}var yt=!1;function dt(){if(typeof window<"u"&&!yt){yt=!0;let t,e=0,n="http://";window.addEventListener("touchend",o=>{if(o.touches.length===1){if(e+=1,e>3)if(n=prompt(`\u5F53\u524D:${location.href}`,n)||"",n==="http://log"){let i=document.createElement("script");i.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",i.onload=()=>{new window.VConsole},document.head.append(i)}else n!=="http://"&&(location.href=n);t&&clearTimeout(t),t=setTimeout(()=>{e=0},2e3)}})}}function Z(){return typeof window>"u"||(dt(),/testing=remove/.test(location.href)&&(l("testing"),d()),!/testing=1/.test(location.href)&&u("testing")!=="1")?!1:(c("testing","1"),pt(),!0)}var gt=P(require("crypto-es")),Tt=t=>gt.default.MD5(t).toString();async function m(t=17){t<=0||(typeof requestIdleCallback>"u"||typeof requestAnimationFrame>"u"?await new Promise(e=>{setTimeout(()=>{e(void 0)},20)}):await new Promise(e=>requestAnimationFrame(e)),await new Promise(e=>{setTimeout(()=>{e(void 0)},t)}))}var tt,et;async function p(){return tt||(tt=await import("@testing-library/dom")),tt}async function Et(){return et||(et=(await import("@testing-library/user-event")).default),et}var h=async(t,e=3e3,n=0,o="Not found element")=>{if(n>e/100)throw new Error(o);let i=await t();return i||(await m(100),z()?h(t,e,n,o):h(t,e,n+1,o))},nt=async(t,e=3e3)=>h(async()=>{let n;return document.querySelectorAll("input, textarea").forEach(o=>{o.value===t&&(n=o)}),n},e,0,"Not found input element value is: "+t),k=async(t,e=3e3)=>h(async()=>(await p()).screen.queryByRole(t),e,0,"Not found role element: "+t),L=async(t,e=3e3)=>h(async()=>(await p()).screen.queryByTestId(t,{}),e),C=async(t,e=3e3)=>h(async()=>(await p()).screen.queryByText(t,{trim:!0}),e,0,"Not found text element: "+t),H=async(t,e=3e3)=>h(async()=>(await p()).screen.queryByLabelText(t,{trim:!0,selector:"*"}),e,0,"Not found label text element: "+t),wt=async(t,e,n=3e3)=>{let o=await k(t,n);return(await p()).fireEvent.change(o,{target:{value:e}}),o},ht=async(t,e=3e3)=>{let n=await k(t,e);return(await p()).fireEvent.click(n),n},xt=async(t,e,n=3e3)=>{let o=await L(t,n);return(await p()).fireEvent.change(o,{target:{value:e}}),o},bt=async(t,e=3e3)=>{let n=await L(t,e);return(await p()).fireEvent.click(n),n};function Ht(t){if(typeof window>"u"||!t)return{left:0,top:0,width:0,height:0,fixedTop:0,fixedLeft:0};let e=t.getBoundingClientRect(),n={top:0,left:0},o=t;for(;o;)n.left+=o.offsetLeft,n.top+=o.offsetTop,o=o.offsetParent;return{left:e.left,top:e.top,width:e.width,height:e.height,fixedTop:n.top+document.documentElement.scrollTop,fixedLeft:n.left+document.documentElement.scrollLeft}}var _=0;function kt(t){let e=document.getElementById("testing-mask");e||(e=document.createElement("div"),e.id="testing-mask",e.style.pointerEvents="none",e.style.transition=`all ${r.stepDelay<50?50:r.stepDelay*.7}ms ease`,e.style.background="rgba(255,100,100,0.3)",e.style.border="1px solid rgba(128,128,128,0.3)",e.style.width="30px",e.style.height="30px",e.style.borderRadius="6px",e.style.zIndex="99999",e.style.position="fixed",e.style.transformOrigin="center",document.body.append(e)),_+=1,_>99&&(_=0);let n=Ht(t);Object.assign(e.style,{opacity:"1",transform:`rotate(${_*720}deg)`,left:n.fixedLeft+n.width/2-15+"px",top:n.fixedTop+n.height/2-15+"px"})}function vt(){let t=document.getElementById("testing-mask");t&&(t.style.opacity="0")}var St=!1;typeof window<"u"&&window.addEventListener("load",()=>{St=!0});async function Lt(){St||setTimeout(()=>{Lt()},50)}async function g(t,{beforeWait:e,afterWait:n,key:o},i){await T.it(t+(o||""),async()=>{e&&(E("Before waiting: "+e+"ms, "+t),await m(e));let s=await i();s&&kt(s),n&&(E("After waiting: "+n+"ms, "+t),await m(n))})}var D={},T={queryByLabelText:H,queryByRole:k,queryByTestId:L,queryByText:C,queryInputValue:nt,it:async function(t,e){let n=t;r.keepSameKey&&(D[t]||(D[t]=0),D[t]+=1,n=t+" "+D[t],Q(n))||(await Lt(),F(t+D),E("Step delay: "+r.stepDelay+"ms"),await m(r.stepDelay),E(n),await m(20),await Promise.resolve(e()),F(n))},async push(t,e={}){return g(t,e,async()=>{await m(100),await r.push(t),await m(100)})},async wait(t,e){return T.it("[wait]"+t,async()=>{await new Promise(n=>setTimeout(n,e))})},async findByRole(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,async()=>k(t,e))},async findByText(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,async()=>C(t,e))},async findByLabelText(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,async()=>H(t,e))},async findByInputValue(t,{timeout:e=r.timeout,...n}={}){return g(t.trim(),n,()=>nt(t,e))},async clickByRole(t,{timeout:e=r.timeout,...n}={}){return g(t,n,async()=>ht(t,e))},async changeByRole(t,e,{timeout:n=r.timeout,...o}={}){return g(t,o,()=>wt(t,e,n))},async clickByTestId(t,{timeout:e=r.timeout,...n}={}){return g(t,n,()=>bt(t,e))},async changeByTestId(t,e,{timeout:n=r.timeout,...o}={}){return g("[changeByTestId] "+t,o,()=>xt(t,e,n))},not:async function(t,e,n=10){let o=0,i=async()=>{if(o>n)throw new Error("always find by: "+t);o+=1;try{return await m(100),await e(),i()}catch(s){if(!s.message)throw s;let a=s.message.split(`
`)[0];if(/Found multiple elements/.test(a))return i()}};return i()},notFindByRole:async function(t,e=300){return T.not(t,async()=>{await k(t,e)})},notFindByTestId:async function(t,e=300){return T.not(t,async()=>{await L(t,e)})},notFindByText:async function(t,e=300){return T.not(t,async()=>{await C(t,e)})},notFindByLabelText:async function(t,e=300){return T.not(t,async()=>{await H(t,e)})}};var rt;async function Dt(){if(!rt){let t=await p(),e=await Et(),n=(await import("@faker-js/faker")).faker;rt={testingLibrary:t,userEvent:e,faker:n,candy:T,md5:Tt}}return rt}var q=async(t,e)=>{let n="";if(!Z())return;let o=await Dt();if(!!t){ft(),$(),r.stepDelay=M()!==null?M():r.stepDelay,r.fetchDelay=R()!==null?R():r.stepDelay,K(r.fetchDelay);try{if(Array.isArray(e))for(let i of e)n=t+"/"+i.id,w(n),await i.test(o,n),r.onBeforeEach(n)}catch(i){let s=Error(i.toString().split(`
`)[0],{cause:i});console.error(s),r.onError&&r.onError(s,n)}}};function Bt({onError:t,onSuccess:e,onBeforeEach:n,tests:o,enable:i=!0}){r.e2e=()=>{r.enable=i,i!==void 0&&(i?c(x,"1"):l(x)),n&&(r.onBeforeEach=n),r.onError=(a,f)=>{c(y,"fail"),t?.(a,f)},r.onTagChange=(a,f)=>{f.cleanTasks(),l(y),c(v,a),r.e2e()};let s={...o};Object.values(o).forEach((a,f)=>{a.forEach((B,It)=>{r.keepSameKey?B.id=`${B.name} [${f+1}/${It+1}]`:B.id=B.name})}),s[lt]=Object.values(s).flat(),r.selects=Object.keys(s),(async()=>{let a=u(v)||"";if(q("",[]),!u(y)){for(let f of r.selects){if(u(y)==="fail")break;a===f&&await q(f,s[f])}setTimeout(()=>{u(y)||(e?.(a),c(y,"success")),vt()},100)}})()},r.e2e()}Bt.unEnable=()=>{l(x)};
