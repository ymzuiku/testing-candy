var Pt=Object.create;var I=Object.defineProperty;var Ot=Object.getOwnPropertyDescriptor;var At=Object.getOwnPropertyNames;var Nt=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty;var ot=(e,t)=>{for(var n in t)I(e,n,{get:t[n],enumerable:!0})},it=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of At(t))!Ft.call(e,i)&&i!==n&&I(e,i,{get:()=>t[i],enumerable:!(o=Ot(t,i))||o.enumerable});return e};var P=(e,t,n)=>(n=e!=null?Pt(Nt(e)):{},it(t||!e||!e.__esModule?I(n,"default",{value:e,enumerable:!0}):n,e)),Mt=e=>it(I({},"__esModule",{value:!0}),e);var _t={};ot(_t,{bindFetchDelay:()=>K,bindPromiseDelay:()=>st,bindWaitByEvent:()=>ct,bindWaitByFech:()=>$,createTesting:()=>Bt,isFetching:()=>z,isNeedTesting:()=>Z,onTesting:()=>q,testingOptions:()=>r});module.exports=Mt(_t);var r={timeout:5e3,stepDelay:100,fetchDelay:0,maskTime:0,keepSameKey:!1,minLogDelay:250,testReStartKey:"",testAgainKey:"",enable:void 0,onError:(e,t)=>{},onBeforeEach:e=>{},onTagChange:(e,t)=>{},selects:[],push:e=>(location.href=e,new Promise(t=>setTimeout(t,100))),e2e:()=>{}};var G;function E(e){let t=document.getElementById("testing-label");t||(t=document.createElement("div"),t.id="testing-label",t.style.pointerEvents="none",t.style.transition=`all ${r.stepDelay<50?50:r.stepDelay*.7}ms ease`,t.style.background="rgba(0,0,0,0.5)",t.style.color="#f33",t.style.height="auto",t.style.borderRadius="6px",t.style.zIndex="99999",t.style.position="fixed",t.style.padding="4px 8px",t.style.right="0px",t.style.bottom="0px",t.style.whiteSpace="nowrap",t.style.transformOrigin="center",document.body.append(t)),t.textContent=e,t.style.opacity="1",G&&clearTimeout(G),G=setTimeout(()=>{t.style.opacity="0"},5e3)}function st(e,t){if(t<1)return e;let n=e;return async function(...o){let i=n(...o).finally(()=>{});return t>=r.minLogDelay&&E("Fetch delay: "+t+"ms"),await new Promise(s=>setTimeout(s,t)),i}}function K(e){window.fetch=st(window.fetch,e)}var j=0;function ct(e,t){let n=e;return async function(...o){return t&&t(...o)?n(...o):(j+=1,n(...o).finally(()=>{j-=1}))}}var at=!1;function $(){at||(at=!0,window.fetch=ct(window.fetch,e=>/\.(svg|jpg|png|gif)/.test(e)))}function z(){return j>0}var lt="Test all",O="TEST",U="Step delay",V="Fetch delay",Y="Test again",J="!! Quit testing mode",x="testing",v="testing-state",y="testing-state-result";var b={};ot(b,{cleanTasks:()=>d,getDoing:()=>S,getFetchDelay:()=>R,getStepTime:()=>M,isDone:()=>Q,setDoing:()=>w,setDone:()=>F,setFetchDelay:()=>X,setStepTime:()=>W,storageGet:()=>u,storageRemove:()=>l,storageSet:()=>c});var A="testing-history";function l(e){typeof window>"u"||sessionStorage.removeItem(e)}function u(e){if(typeof window>"u")return;let t=sessionStorage.getItem(e);if(!!t)try{return JSON.parse(t).j}catch{return}}function c(e,t){typeof window>"u"||sessionStorage.setItem(e,JSON.stringify({j:t}))}function N(){let e=u(A);return e||(e={}),e}function Q(e){let t=N();return t[t.doing+e]==="done"}function F(e){let t=N();t[t.doing+e]="done",c(A,t)}function w(e){let t=N();t.doing=e,c(A,t)}function S(){return N().doing}function d(){l(y),c(A,{})}function W(e){c("stepTime",e)}function M(){let e=u("stepTime");return e!==0&&!e?null:e}function X(e){c("fetchDelay",e)}function R(){let e=u("fetchDelay");return e!==0&&!e?null:e}var ut=!1;function mt(){if(typeof window>"u"||r.testAgainKey===""&&r.testReStartKey===""||ut)return;ut=!0;let e=t=>{if(!t.ctrlKey&&!t.metaKey)return!0;if(t.key===r.testReStartKey){t.preventDefault(),t.stopPropagation();let n=S();return d(),w(n),r.e2e(),!1}return t.key===r.testAgainKey&&(t.preventDefault(),t.stopPropagation(),r.e2e()),!1};window.addEventListener("keydown",e)}var Rt=[O,U,V,Y],Ct=[J];function ft(e){e.innerHTML="";let t=document.createElement("select");t.value="TEST",t.name="testing-select",Object.assign(t.style,{appearance:"none",boxShadow:"none",border:"none",borderRadius:"0px",outline:"none",background:"rgba(0,0,0,0)",color:"#fff",padding:"0px",fontSize:"14px",position:"absolute",left:0,top:0,width:"100px",opacity:"0"}),Object.assign(e.style,{right:"0",top:"0",position:"fixed",zIndex:"9999",width:"100px",height:"20px",background:"#f33",opacity:"0.6",cursor:"pointer",transformOrigin:"left",display:"flex",justifyContent:"center",alignItems:"center",transform:"rotate(45deg) translate(11px, -50px)"});let n=document.createElement("div");Object.assign(n.style,{width:"100px",height:"100%",textAlign:"center",PointerEvent:"none",color:"#fff",marginTop:"3px",fontSize:"14px",fontWeight:"700"}),n.textContent="TEST",e.appendChild(n),e.append(t),[...Rt,...r.selects,...r.enable===void 0?Ct:[]].forEach(i=>{let s=document.createElement("option");s.value=i,s.textContent=i,t.append(s)}),t.onchange=i=>{let s=i.target.value;if(t.value=O,s===U){let a=Number(prompt("Please input step time(ms):"));if(isNaN(a))return;W(a);return}if(s===V){let a=Number(prompt("Please input step time(ms):"));if(isNaN(a))return;X(a);return}if(s===J){d(),l(x),location.reload();return}if(s===O){d(),l(v);return}if(s===Y){let a=S();d(),w(a),r.e2e();return}r.onTagChange(s,b)}}function pt(){let e=document.getElementById("renderTestingTag");if(e){ft(e);return}let t=document.createElement("div");t.id="renderTestingTag",ft(t),document.body.appendChild(t)}var yt=!1;function dt(){if(typeof window<"u"&&!yt){yt=!0;let e,t=0,n="http://";window.addEventListener("touchend",o=>{if(o.touches.length===1){if(t+=1,t>3)if(n=prompt(`\u5F53\u524D:${location.href}`,n)||"",n==="http://log"){let i=document.createElement("script");i.src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js",i.onload=()=>{new window.VConsole},document.head.append(i)}else n!=="http://"&&(location.href=n);e&&clearTimeout(e),e=setTimeout(()=>{t=0},2e3)}})}}function Z(){return typeof window>"u"||(dt(),/testing=remove/.test(location.href)&&(l("testing"),d()),!/testing=1/.test(location.href)&&u("testing")!=="1")?!1:(c("testing","1"),pt(),!0)}var gt=P(require("crypto-es")),Tt=e=>gt.default.MD5(e).toString();async function f(e=17){e<=0||(typeof requestIdleCallback>"u"||typeof requestAnimationFrame>"u"?await new Promise(t=>{setTimeout(()=>{t(void 0)},20)}):await new Promise(t=>requestAnimationFrame(t)),await new Promise(t=>{setTimeout(()=>{t(void 0)},e)}))}var tt,et;async function p(){return tt||(tt=await import("@testing-library/dom")),tt}async function Et(){return et||(et=(await import("@testing-library/user-event")).default),et}var h=async(e,t=3e3,n=0,o="Not found element")=>{if(n>t/100)throw new Error(o);let i=await e();return i||(await f(100),z()?h(e,t,n,o):h(e,t,n+1,o))},nt=async(e,t=3e3)=>h(async()=>{let n;return document.querySelectorAll("input, textarea").forEach(o=>{o.value===e&&(n=o)}),n},t,0,"Not found input element value is: "+e),k=async(e,t=3e3)=>h(async()=>(await p()).screen.queryByRole(e),t,0,"Not found role element: "+e),L=async(e,t=3e3)=>h(async()=>(await p()).screen.queryByTestId(e,{}),t),C=async(e,t=3e3)=>h(async()=>(await p()).screen.queryByText(e,{trim:!0}),t,0,"Not found text element: "+e),H=async(e,t=3e3)=>h(async()=>(await p()).screen.queryByLabelText(e,{trim:!0,selector:"*"}),t,0,"Not found label text element: "+e),wt=async(e,t,n=3e3)=>{let o=await k(e,n);return(await p()).fireEvent.change(o,{target:{value:t}}),o},ht=async(e,t=3e3)=>{let n=await k(e,t);return(await p()).fireEvent.click(n),n},xt=async(e,t,n=3e3)=>{let o=await L(e,n);return(await p()).fireEvent.change(o,{target:{value:t}}),o},bt=async(e,t=3e3)=>{let n=await L(e,t);return(await p()).fireEvent.click(n),n};function Ht(e){if(typeof window>"u"||!e)return{left:0,top:0,width:0,height:0,fixedTop:0,fixedLeft:0};let t=e.getBoundingClientRect(),n={top:0,left:0},o=e;for(;o;)n.left+=o.offsetLeft,n.top+=o.offsetTop,o=o.offsetParent;return{left:t.left,top:t.top,width:t.width,height:t.height,fixedTop:n.top+document.documentElement.scrollTop,fixedLeft:n.left+document.documentElement.scrollLeft}}var _=0;function kt(e){let t=document.getElementById("testing-mask");t||(t=document.createElement("div"),t.id="testing-mask",t.style.pointerEvents="none",t.style.transition=`all ${r.stepDelay<100?100:r.stepDelay*.7}ms ease`,t.style.background="rgba(255,100,100,0.3)",t.style.border="1px solid rgba(128,128,128,0.3)",t.style.width="30px",t.style.height="30px",t.style.borderRadius="6px",t.style.zIndex="99999",t.style.position="fixed",t.style.transformOrigin="center",document.body.append(t)),_+=1,_>99&&(_=0);let n=Ht(e);Object.assign(t.style,{opacity:"1",transform:`rotate(${_*720}deg)`,left:n.fixedLeft+n.width/2-15+"px",top:n.fixedTop+n.height/2-15+"px"})}function vt(){let e=document.getElementById("testing-mask");e&&(e.style.opacity="0")}var St=!1;typeof window<"u"&&window.addEventListener("load",()=>{St=!0});async function Lt(){St||setTimeout(()=>{Lt()},50)}async function g(e,{beforeWait:t,afterWait:n,key:o},i){await T.it(e+(o||""),async()=>{t&&(t>=r.minLogDelay&&E("Before waiting: "+t+"ms, "+e),await f(t));let s=await i();s&&kt(s),n&&(n>=r.minLogDelay&&E("After waiting: "+n+"ms, "+e),await f(n))})}var D={},T={queryByLabelText:H,queryByRole:k,queryByTestId:L,queryByText:C,queryInputValue:nt,it:async function(e,t){let n=e;r.keepSameKey&&(D[e]||(D[e]=0),D[e]+=1,n=e+" "+D[e],Q(n))||(await Lt(),F(e+D),r.stepDelay>=r.minLogDelay&&E("Step delay: "+r.stepDelay+"ms"),await f(r.stepDelay),E(n),await f(20),await Promise.resolve(t()),F(n))},async push(e,t={}){return g(e,t,async()=>{await f(100),await r.push(e),await f(100)})},async wait(e,t){return T.it("[wait]"+e,async()=>{await new Promise(n=>setTimeout(n,t))})},async findByRole(e,{timeout:t=r.timeout,...n}={}){return g(e.trim(),n,async()=>k(e,t))},async findByText(e,{timeout:t=r.timeout,...n}={}){return g(e.trim(),n,async()=>C(e,t))},async findByLabelText(e,{timeout:t=r.timeout,...n}={}){return g(e.trim(),n,async()=>H(e,t))},async findByInputValue(e,{timeout:t=r.timeout,...n}={}){return g(e.trim(),n,()=>nt(e,t))},async clickByRole(e,{timeout:t=r.timeout,...n}={}){return g(e,n,async()=>ht(e,t))},async changeByRole(e,t,{timeout:n=r.timeout,...o}={}){return g(e,o,()=>wt(e,t,n))},async clickByTestId(e,{timeout:t=r.timeout,...n}={}){return g(e,n,()=>bt(e,t))},async changeByTestId(e,t,{timeout:n=r.timeout,...o}={}){return g("[changeByTestId] "+e,o,()=>xt(e,t,n))},not:async function(e,t,n=10){let o=0,i=async()=>{if(o>n)throw new Error("always find by: "+e);o+=1;try{return await f(100),await t(),i()}catch(s){if(!s.message)throw s;let a=s.message.split(`
`)[0];if(/Found multiple elements/.test(a))return i()}};return i()},notFindByRole:async function(e,t=300){return T.not(e,async()=>{await k(e,t)})},notFindByTestId:async function(e,t=300){return T.not(e,async()=>{await L(e,t)})},notFindByText:async function(e,t=300){return T.not(e,async()=>{await C(e,t)})},notFindByLabelText:async function(e,t=300){return T.not(e,async()=>{await H(e,t)})}};var rt;async function Dt(){if(!rt){let e=await p(),t=await Et(),n=(await import("@faker-js/faker")).faker;rt={testingLibrary:e,userEvent:t,faker:n,candy:T,md5:Tt}}return rt}var q=async(e,t)=>{let n="";if(!Z())return;let o=await Dt();if(!!e){mt(),$(),r.stepDelay=M()!==null?M():r.stepDelay,r.fetchDelay=R()!==null?R():r.stepDelay,K(r.fetchDelay);try{if(Array.isArray(t))for(let i of t)n=e+"/"+i.id,w(n),await i.test(o,n),r.onBeforeEach(n)}catch(i){let s=Error(i.toString().split(`
`)[0],{cause:i});console.error(s),r.onError&&r.onError(s,n)}}};function Bt({onError:e,onSuccess:t,onBeforeEach:n,tests:o,enable:i=!0}){r.e2e=()=>{r.enable=i,i!==void 0&&(i?c(x,"1"):l(x)),n&&(r.onBeforeEach=n),r.onError=(a,m)=>{c(y,"fail"),e?.(a,m)},r.onTagChange=(a,m)=>{m.cleanTasks(),l(y),c(v,a),r.e2e()};let s={...o};Object.values(o).forEach((a,m)=>{a.forEach((B,It)=>{r.keepSameKey?B.id=`${B.name} [${m+1}/${It+1}]`:B.id=B.name})}),s[lt]=Object.values(s).flat(),r.selects=Object.keys(s),(async()=>{let a=u(v)||"";if(q("",[]),!u(y)){for(let m of r.selects){if(u(y)==="fail")break;a===m&&await q(m,s[m])}setTimeout(()=>{u(y)||(t?.(a),c(y,"success")),vt()},100)}})()},r.e2e()}Bt.unEnable=()=>{l(x)};
